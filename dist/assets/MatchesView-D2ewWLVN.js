import{u as te,a as ae,r as m,o as oe,c as I,b as O,w as a,V as ne,d as y,e as t,f as g,g as d,h as r,i as u,j as c,k as $,l as W,F as j,m as G,n as C,p as w,q as ue,s as se,t as p,v as k,x as de,y as re,z as ie,A as _,B as T,C as me,D as pe,E as ve,G as ce,H as F,I as z}from"./index-BS-_TD4h.js";const fe={class:"text-h6"},Ve={class:"text-subtitle-2 text-medium-emphasis"},ye={class:"text-h5"},Se={class:"text-caption text-medium-emphasis"},be={class:"text-subtitle-2"},we={__name:"MatchesView",setup(ge){const f=te(),D=ae(),x=m(!1),S=m(!1),b=m(!1),V=m(null),A=m(null),M=m(""),U=m(null),N=m(null),B=m(null),n=m({opponentId:"",tournamentName:"",division:"",date:new Date().toISOString().split("T")[0],scores:[{set:1,myScore:0,oppScore:0}],notes:"",photos:[],videoUrls:[],serveStats:{successRate:0,returnPoints:0}}),v=m({name:"",playingStyle:"",club:""});oe(async()=>{await Promise.all([f.fetchMatches(),D.fetchOpponents()])});const E=I(()=>D.opponents),H=I(()=>{const o=new Set(f.matches.map(e=>e.division));return Array.from(o)}),J=I(()=>{let o=f.matches;if(M.value){const e=M.value.toLowerCase();o=o.filter(l=>R(l.opponentId).toLowerCase().includes(e)||l.tournamentName?.toLowerCase().includes(e))}return U.value&&(o=o.filter(e=>e.division===U.value)),N.value&&(o=o.filter(e=>e.opponentId===N.value)),o}),L=(o=null)=>{o?(V.value=o,n.value={...o,date:o.date.toISOString().split("T")[0]}):(V.value=null,n.value={opponentId:"",tournamentName:"",division:"",date:new Date().toISOString().split("T")[0],scores:[{set:1,myScore:0,oppScore:0}],notes:"",photos:[],videoUrls:[],serveStats:{successRate:0,returnPoints:0}}),x.value=!0},q=()=>{x.value=!1,V.value=null},K=()=>{n.value.scores.push({set:n.value.scores.length+1,myScore:0,oppScore:0})},Q=o=>{n.value.scores.splice(o,1),n.value.scores.forEach((e,l)=>{e.set=l+1})},X=async()=>{const{valid:o}=await B.value.validate();if(!o)return;const e={...n.value,date:new Date(n.value.date)};try{V.value?await f.updateMatch(V.value.id,e):await f.addMatch(e),q()}catch(l){console.error("Error saving match:",l)}},Y=o=>{A.value=o,b.value=!0},Z=async()=>{try{await f.deleteMatch(A.value.id),b.value=!1,A.value=null}catch(o){console.error("Error deleting match:",o)}},h=async()=>{try{await D.addOpponent(v.value),S.value=!1,v.value={name:"",playingStyle:"",club:""}}catch(o){console.error("Error adding opponent:",o)}},P=o=>{const e=o.scores.reduce((s,i)=>s+i.myScore,0),l=o.scores.reduce((s,i)=>s+i.oppScore,0);return e>l?"Win":"Loss"},ee=o=>{const e=o.scores.reduce((s,i)=>s+i.myScore,0),l=o.scores.reduce((s,i)=>s+i.oppScore,0);return`${e}-${l}`},le=o=>o.scores.map(e=>`${e.myScore}-${e.oppScore}`).join(", "),R=o=>{const e=D.opponents.find(l=>l.id===o);return e?e.name:"Unknown"};return(o,e)=>(y(),O(ne,null,{default:a(()=>[t(g,{class:"mb-4"},{default:a(()=>[t(d,null,{default:a(()=>[t(r,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>L())},{default:a(()=>[...e[18]||(e[18]=[u(" Add Match ",-1)])]),_:1})]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(d,{cols:"12",md:"4"},{default:a(()=>[t(c,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=l=>M.value=l),"prepend-inner-icon":"mdi-magnify",label:"Search matches",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:a(()=>[t($,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=l=>U.value=l),items:H.value,label:"Filter by Division",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),t(d,{cols:"12",md:"4"},{default:a(()=>[t($,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=l=>N.value=l),items:E.value,"item-title":"name","item-value":"id",label:"Filter by Opponent",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),t(g,null,{default:a(()=>[(y(!0),W(j,null,G(J.value,l=>(y(),O(d,{key:l.id,cols:"12"},{default:a(()=>[t(C,null,{default:a(()=>[t(w,null,{default:a(()=>[t(g,{align:"center"},{default:a(()=>[t(d,{cols:"auto"},{default:a(()=>[t(ue,{color:P(l)==="Win"?"success":"error",size:"60"},{default:a(()=>[t(se,{size:"32"},{default:a(()=>[u(p(P(l)==="Win"?"mdi-check":"mdi-close"),1)]),_:2},1024)]),_:2},1032,["color"])]),_:2},1024),t(d,null,{default:a(()=>[k("div",fe,"vs "+p(R(l.opponentId)),1),k("div",Ve,p(de(re)(l.date))+" â€¢ "+p(l.tournamentName||"Friendly Match"),1),t(ie,{size:"small",class:"mt-1"},{default:a(()=>[u(p(l.division),1)]),_:2},1024)]),_:2},1024),t(d,{cols:"auto"},{default:a(()=>[k("div",ye,p(ee(l)),1),k("div",Se,p(le(l)),1)]),_:2},1024),t(d,{cols:"auto"},{default:a(()=>[t(r,{icon:"mdi-pencil",variant:"text",onClick:s=>L(l)},null,8,["onClick"]),t(r,{icon:"mdi-delete",variant:"text",color:"error",onClick:s=>Y(l)},null,8,["onClick"]),t(r,{icon:"mdi-arrow-right",variant:"text",to:`/matches/${l.id}`},null,8,["to"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(_,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=l=>x.value=l),"max-width":"800",persistent:""},{default:a(()=>[t(C,null,{default:a(()=>[t(T,null,{default:a(()=>[u(p(V.value?"Edit Match":"Add New Match"),1)]),_:1}),t(w,null,{default:a(()=>[t(me,{ref_key:"matchForm",ref:B},{default:a(()=>[t(pe,{modelValue:n.value.opponentId,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.opponentId=l),items:E.value,"item-title":"name","item-value":"id",label:"Opponent",variant:"outlined",rules:[l=>!!l||"Opponent is required"]},{append:a(()=>[t(r,{icon:"mdi-plus",size:"small",onClick:e[4]||(e[4]=l=>S.value=!0)})]),_:1},8,["modelValue","items","rules"]),t(c,{modelValue:n.value.tournamentName,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.tournamentName=l),label:"Tournament Name",variant:"outlined"},null,8,["modelValue"]),t(c,{modelValue:n.value.division,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.division=l),label:"Division",variant:"outlined",rules:[l=>!!l||"Division is required"]},null,8,["modelValue","rules"]),t(c,{modelValue:n.value.date,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.date=l),label:"Date",type:"date",variant:"outlined",rules:[l=>!!l||"Date is required"]},null,8,["modelValue","rules"]),t(C,{variant:"outlined",class:"mb-4"},{default:a(()=>[t(T,{class:"text-subtitle-1"},{default:a(()=>[...e[19]||(e[19]=[u("Scores",-1)])]),_:1}),t(w,null,{default:a(()=>[(y(!0),W(j,null,G(n.value.scores,(l,s)=>(y(),O(g,{key:s,align:"center"},{default:a(()=>[t(d,{cols:"2"},{default:a(()=>[k("div",be,"Set "+p(s+1),1)]),_:2},1024),t(d,null,{default:a(()=>[t(c,{modelValue:l.myScore,"onUpdate:modelValue":i=>l.myScore=i,modelModifiers:{number:!0},label:"My Score",type:"number",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(d,null,{default:a(()=>[t(c,{modelValue:l.oppScore,"onUpdate:modelValue":i=>l.oppScore=i,modelModifiers:{number:!0},label:"Opponent Score",type:"number",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(d,{cols:"auto"},{default:a(()=>[n.value.scores.length>1?(y(),O(r,{key:0,icon:"mdi-close",size:"small",onClick:i=>Q(s)},null,8,["onClick"])):ve("",!0)]),_:2},1024)]),_:2},1024))),128)),t(r,{"prepend-icon":"mdi-plus",size:"small",onClick:K},{default:a(()=>[...e[20]||(e[20]=[u("Add Set",-1)])]),_:1})]),_:1})]),_:1}),t(ce,{modelValue:n.value.notes,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.notes=l),label:"Match Notes",variant:"outlined",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),t(F,null,{default:a(()=>[t(z),t(r,{text:"",onClick:q},{default:a(()=>[...e[21]||(e[21]=[u("Cancel",-1)])]),_:1}),t(r,{color:"primary",onClick:X},{default:a(()=>[...e[22]||(e[22]=[u("Save",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(_,{modelValue:S.value,"onUpdate:modelValue":e[15]||(e[15]=l=>S.value=l),"max-width":"500"},{default:a(()=>[t(C,null,{default:a(()=>[t(T,null,{default:a(()=>[...e[23]||(e[23]=[u("Add New Opponent",-1)])]),_:1}),t(w,null,{default:a(()=>[t(c,{modelValue:v.value.name,"onUpdate:modelValue":e[11]||(e[11]=l=>v.value.name=l),label:"Name",variant:"outlined"},null,8,["modelValue"]),t($,{modelValue:v.value.playingStyle,"onUpdate:modelValue":e[12]||(e[12]=l=>v.value.playingStyle=l),items:["Aggressive","Defensive","Mixed"],label:"Playing Style",variant:"outlined"},null,8,["modelValue"]),t(c,{modelValue:v.value.club,"onUpdate:modelValue":e[13]||(e[13]=l=>v.value.club=l),label:"Club",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(F,null,{default:a(()=>[t(z),t(r,{text:"",onClick:e[14]||(e[14]=l=>S.value=!1)},{default:a(()=>[...e[24]||(e[24]=[u("Cancel",-1)])]),_:1}),t(r,{color:"primary",onClick:h},{default:a(()=>[...e[25]||(e[25]=[u("Add",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(_,{modelValue:b.value,"onUpdate:modelValue":e[17]||(e[17]=l=>b.value=l),"max-width":"400"},{default:a(()=>[t(C,null,{default:a(()=>[t(T,null,{default:a(()=>[...e[26]||(e[26]=[u("Delete Match",-1)])]),_:1}),t(w,null,{default:a(()=>[...e[27]||(e[27]=[u("Are you sure you want to delete this match?",-1)])]),_:1}),t(F,null,{default:a(()=>[t(z),t(r,{text:"",onClick:e[16]||(e[16]=l=>b.value=!1)},{default:a(()=>[...e[28]||(e[28]=[u("Cancel",-1)])]),_:1}),t(r,{color:"error",onClick:Z},{default:a(()=>[...e[29]||(e[29]=[u("Delete",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{we as default};
